= Таблица

== Назначение

Элемент предназначен для организации табличного ввода данных. В качестве элементов таблицы могут быть данные любых простых типов, а также ссылочные данные (ссылки на справочники и карточки Docsvision).

При работе с элементом управления *Таблица* из карточки _Документ_, при внесении каких-либо изменений в таблицу, в истории карточки фиксируется информация об изменении элемента, но не указывается, что именно было изменено.

== Отображение в области "Панель инструментов"

 +
image:img/lay_Element_Table.png[image] +

== Отображение в запущенной карточке

 +
image:img/lay_Card_Table.png[image] +

Если столбец таблицы содержит ссылочные данные, в его ячейках будут отображаться кнопки для управления этими данными:

* кнопка выбора объекта;
* кнопка, позволяющая очистить поле.

 +
image:img/lay_Table_ref_data.png[image] +

Для ячеек таблицы числовых типов (int, float и т.д.) для чисел, состоящих из 4 и более знаков, при отображении каждые три цифры разделяются знаком, который в настройках MS Windows определен как разделитель групп разрядов. В дробной части разделения цифр не предусмотрено (например: 1 234 567, 1234).

[NOTE]
====
Настройка параметра _Разделитель групп разрядов_ выполняется для выбранного языка в _Панели управления_ Windows в подразделе *Язык и региональные стандарты*. Настройка разделителя выполняется отдельно для каждой из используемых локализаций.
====

Если столбец содержит карточку, станет активной кнопка image:buttons/lay_table_open_card.png[image], предназначенная для открытия карточки.

== Общие

xref:lay_Elements_general.adoc[Общие свойства элементов управления]

== Внешний вид

Видимость панели группировки::
  Включает (Да) или выключает (Нет) отображение панели группировки. С помощью данной панели осуществляется возможность группировки табличных данных по выбранным полям.
Скрыть панель с командами::
  Включает (Нет) или выключает (Да) отображение панели команд.
Столбцы::
  Представляет собой коллекцию столбцов таблицы. В таблицу необходимо добавить хотя бы один столбец. Для настройки атрибута служит специальный диалог, который предоставляет возможности по добавлению, удалению и настройке столбца.
  +
  image::lay_Table_column_attr.png[image]
  +
  Для столбца доступны для настройки некоторые из xref:lay_Elements_general.adoc[общих] атрибутов элементов. Кроме этого, доступны дополнительные атрибуты:

  * В категории *Общие*:
  ** *Видимый* - определяет, отображать (True) или не отображать (False) столбец.
  ** *Имя* - название столбца.
  ** *Только для чтения* - определяет, запрещены (True) или разрешены (False) операции с данными столбца.
  ** [#reference_fbx_5qz_fm__width]#*Ширина* - определяет ширину столбца.
  * В категории *Внешний вид*:
  ** [#reference_fbx_5qz_fm__header]#*Заголовок* - текст, отображаемый в заголовке столбца.
  +
  В категории *Данные*:
  ** *Значения энумератора* – список возможных значений для столбца типа "Перечисление".
  ** *Изображение* – изображение, используемое в заголовке столбца.
  * В категории *Поведение*:
  ** [#reference_fbx_5qz_fm__max_width]#*Максимальная ширина* – задает максимальную ширину столбца.
  ** [#reference_fbx_5qz_fm__min_width]#*Минимальная ширина* – задает минимальную ширину столбца.
  ** *Поле родительской секции* – задает атрибуты родительской секции ссылки.
  ** *Поле ссылки* – определяет ссылку, к которой будет привязана каждая строка таблицы. Если значение задано, то при добавлении каждой новой строки пользователю необходимо будет выбрать или значение из справочника, соответствующего указанной ссылке, или карточку Docsvision. Эта функциональность может быть полезна, если требуется организовать таблицу, в каждой строке которой обязательно должно быть выбрано значение какого-то из ссылочных полей, например, таблицу сотрудников с указанием согласия/несогласия с содержанием документа (таблица визирующих лиц). Выбор значения осуществляется из списка.
  ** *Поле родительской секции* – используется для получения данных родительской секции по ссылке из дочерней секции. Например, может использоваться, чтобы при выборе сотрудника отображался e-mail Организации, в которой он числится.
  ** *Ссылочная колонка* – колонка таблицы, на которую необходимо сослаться.
  ** *Ссылочная секция –* секция таблицы, на которую необходимо сослаться.
  +
  Для свойства предусмотрена xref:lay_Elements_Table.adoc#reference_fbx_5qz_fm__set_locale[настройка локализации].

== Данные

У элемента типа *Таблица* есть атрибут *Источник данных,* в котором с помощью специального редактора (выпадающий список) можно выбрать коллекционный раздел настраиваемой карточки. У столбца есть атрибут *Элемент данных,* в котором выбирается поле, к которому будет привязан столбец. При последующей работе таблица сохраняется в указанный раздел в соответствующие поля. Если для какого-то из столбцов не указан элемент данных, он сохраняется как свойство.

Источник данных::
  Тип поля данных - привязывается к табличной секции, содержащей поля любых допустимых в _Docsvision_ типов. Указать расширенную секцию типа _Table_.
  +
  [[reference_fbx_5qz_fm__bind_to_section]]
  [NOTE]
====
Привязывать к одной секции разные коллекционные элементы управления не рекомендуется.
  ====
Порядок::
  Используется для выбора целочисленного поля для хранения порядка сортировки в таблице (с изменением фактического порядка строк). При выборе *Источника данных* в выпадающем списке будут отображаться доступные поля типа `int`, содержащиеся в привязанной к элементу табличной секции.

== Поведение

Индекс быстрого поиска::
  Определяет количество символов, после ввода которых будет выполнен быстрый поиск подходящих значений в соответствующем справочнике. Значение поля – целое положительное число. Минимальное значение = 1. Значение по умолчанию = 3. См. xref:lay_Elements_general.adoc[Общие свойства элементов управления].
  +
  Быстрый поиск может применяться для таблиц, связанных со _Справочником сотрудников_, _Справочником контрагентов_ и _Конструктором справочников_ и доступен для столбцов, предусматривающих выбор:
  +
  * организации;
  * подразделения;
  * сотрудника;
  * организации контрагента;
  * подразделения контрагента;
  * сотрудника контрагента;
  * значения из конструктора справочников.
  +
  Режим быстрого поиска определяется настройкой в справочнике _Системных настроек_.

[[reference_fbx_5qz_fm__set_locale]]
== Настройка локализации

Допускается xref:lay_Locale_common_element_properties.adoc[локализация _общих_ свойств] элемента. Описание настройки локализации содержится в разделе xref:lay_Elements_general.adoc[Общие свойства элементов управления].

Для элемента *Таблица* могут быть локализованы следующие элементы свойства xref:lay_Elements_Table.adoc#reference_fbx_5qz_fm__Column[*Столбцы*]:

* xref:lay_Elements_Table.adoc#reference_fbx_5qz_fm__header[*Заголовок*];
* xref:lay_Elements_Table.adoc#reference_fbx_5qz_fm__width[*Ширина*];
* xref:lay_Elements_Table.adoc#reference_fbx_5qz_fm__max_width[*Максимальная ширина*];
* xref:lay_Elements_Table.adoc#reference_fbx_5qz_fm__min_width[*Минимальная ширина*].

Добавление локализованных названий выполняется в окне, открываемом при выборе свойства *Столбцы*, при нажатии на кнопку в правой части поля перечисленных выше свойств.

image::lay_Locale_table_columns.png[Открытие окна локализации для свойств элемента управления "Таблица"]

Для свойства *Заголовок* будет открыто окно *Локализация отображаемого значения*, в котором следует указать значение локализации, которое будет использоваться по умолчанию, и текст локализованных названий. Для свойств *Ширина*, *Максимальная ширина*, *Минимальная ширина* будет открыто аналогичное окно *Локализация значения*. Подробнее о настройке локализации см. раздел xref:lay_Layout_locale.adoc[Локализация разметки].

image::lay_Locale_table_columns_add_localisation.png[Добавление локализации для свойства "Заголовок"]

Также для элемента *Таблица* имеется особенность настройки локализации xref:lay_Elements_general.adoc[общего свойства] *Местоположение метки*. При создании таблицы, для свойства будет задано значение _Сверху_. Однако, по умолчанию для этого свойства используется значение _Слева_. Поэтому, если для свойства будет выбрано значение "по умолчанию", метка будет расположена в соответствии со значением по умолчанию, то есть "слева".

== Ограничение выбора данных из Конструктора справочников

Если в таблице есть столбцы, связанные с _Конструктором справочников_, для их ячеек можно добавить ограничение области выбора и поиска данных.

Ограничение устанавливается программным способом при возникновении события *UniversalChooseBoxInitializing* таблицы.

image::lay_Table_Event_Universal.png[Добавление события в свойствах таблицы]

Обработчик события должен выглядеть следующим образом:

[source,pre,codeblock,language-C#]
----
private void TableRefUni_UniversalChooseBoxInitializing(System.Object sender, UniversalItemChooseBoxColumnEventArgs e)
{
 // Определение идентификатора узла, которым ограничен выбор данных из Конструктора справочников
 e.UniversalItemChooseBox.ItemTypeId = new Guid("2F1F3B03-88BF-4059-ADAF-B2818CB7CAAA");

 // Область выбора
 e.UniversalItemChooseBox.SelectionArea = UniversalItemTypeSelectionArea.Subnodes;
}
----

Область выбора может принимать одно из значений:

* UniversalItemTypeSelectionArea.Node - разрешает выбор записей только из узла, указанного в ItemTypeId;
* UniversalItemTypeSelectionArea.NodeAndSubnodes - выбор из узла ItemTypeId и из его подчиненных узлов;
* UniversalItemTypeSelectionArea.Subnodes - выбор только из подчиненных (ItemTypeId) узлов.

Если в таблице несколько колонок, связанных с _Конструктором справочников_, то добавить отдельные условия для них можно, к примеру, проверив имя столбца перед установкой ограничений:

[source,pre,codeblock,language-C#]
----
if(e.Column.Name = "FirtsColumnName")
{
 e.UniversalItemChooseBox.ItemTypeId = new Guid("2F1F3B03-88BF-4059-ADAF-B2818CB7CAAA");
 e.UniversalItemChooseBox.SelectionArea = UniversalItemTypeSelectionArea.Subnodes;
}else if(e.Column.Name = "SecondColumn")
{
 e.UniversalItemChooseBox.ItemTypeId = new Guid("E07C7F1C-7D9A-4AEA-9500-888496AAE30E");
 e.UniversalItemChooseBox.SelectionArea = UniversalItemTypeSelectionArea.Node;
}else if ...
----
