= Добавление, изменение и удаление поля

Поле может быть добавлено только к расширенной секции.

Условия использования расширенных метаданных:

* Чтобы минимизировать риск возникновения конфликтов с имеющимися расширенными полями, для добавления пользовательских полей _рекомендуется_ использовать пользовательские секции. При этом, никаких запретов добавления расширенных полей в статические секции нет.
* Системные секции нельзя использовать для добавления пользовательских полей. Системная секция предназначена для хранения системной информации о карточке. В каждой карточке такая секция имеет своё название (например, секция "Системные свойства" (SystemInfo)).
* Операции по изменению расширенных полей и секций будут приводить к изменениям в схеме таблиц и обновлению хранимых процедур. Такие операции могут блокировать другие транзакции и значительно влиять на время выполнения пользовательских операций. Поэтому изменения в расширенных метаданных стоит выполнять в нерабочее время.
* Для корректной работы с видами, в которых были выполнены операции над расширенными полями, необходимо перезапустить сервисы {dv}.

.Чтобы добавить поле:
. xref:layouts/lay_Set_dinamic_metadata.adoc[Откройте] окно *Редактирование метаданных*.
. Выберите секцию, в которую требуется добавить поле.
. Нажмите кнопку image:buttons/lay_Field_add.png[image].
+
Кнопка активна, если в дереве выделена любая секция.
+
Будет открыто окно *Редактирование динамического поля*.
+
.Редактирование динамического поля
image::lay_DinamicField_edit.png[Редактирование динамического поля]
+
. В поле *Имя* укажите произвольное текстовое обозначение элемента.
+
В качестве имен нельзя использовать служебные обозначения: _UserID_, _SessionID_, _InstanceID_, _RowID_, _ParentRowID_, _ParentTreeRowID_, _ChangeServerID_, _SDID_ и прочие.
+
Длина имени поля не должна превышать 20 символов.
+
.Использовать кириллицу в названии расширенных полей:
* для БД Microsoft SQL -- не рекомендуется;
* для БД PostgreSQL -- *запрещено*.
. В поле *Тип* выберите один из доступных вариантов, приведенных в таблице.
+
[cols=",",options="header"]
|===
|Обозначение типа |Значение
|Int |Целое
|Bool |Логический тип (возможны значения true/false)
|DateTime |Дата/время
|Enum |Перечисление
|Bitmask |Битовая маска
|UniqueID |Уникальный идентификатор
|UserID |Идентификатор пользователя
|String |Короткая текстовая строка
|UniString |Строка в формате Unicode
|FileID |Идентификатор файла
|Float |Значение с плавающей точкой
|RefID |Ссылка на значение из справочника или на сам справочник
|RefCardID |Ссылка на карточку
|Text |Текст
|Unitext |Универсальный текст
|Binary |Значение в двоичном виде
|Image |Изображение
|Decimal |Десятичное значение
|Variant |Универсальное поле
|===
+
Для полей с текстовым содержимым рекомендуется выбирать типы Text и Unitext, для которых в БД отсутствует явное ограничение по размеру содержимого -- в MS SQL представлены типами varchar(max) и nvarchar(max) соответственно, -- в отличии от типов String и Unistring, для которых установлено ограничение на размер содержимого -- _varchar(8000)_ и _nvarchar(8000)_ соответственно. Также следует обратить внимание, что при изменении типа существующего поля с String на Unistring, или с Unistring на String для них сохраняется установленное при создании ограничение на размер содержимого: для String -- 4000 знаков, для Unistring -- 8000 знаков. Фактическое ограничение размера поля смотрите в таблице "dvsys_fielddefs" базы данных {dv}.
+
Значение поля типа Decimal в пользовательском интерфейсе отображается с разделителем, установленным в региональных настройках. При изменении значения поля также необходимо использовать десятичный разделитель, установленный в региональных настройках.
+
[IMPORTANT]
====
Не рекомендуется изменять тип *существующего* расширенного поля. Если новый тип не совместим с текущим, то изменение типов приведет к ошибке.
====
+
. В поле *Ссылка* укажите значение для ссылки.
+
Поле доступно, если для типа ссылки указано значение _RefID_ или _RefCardID_.
. В поле *Тип ссылки* укажите значение типа ссылки.
+
Поле доступно только для типа _RefCardID_.
+
.Доступные варианты:
* Не указан;
* Слабая ссылка;
* Сильная ссылка;
* Авто (тип определяется автоматически).
. В поле *Перечисление* укажите возможные значения поля.
+
Поле доступно только для типа Enum.
+
.. Нажмите кнопку image:buttons/lay_threedots.png[image].
.. В появившемся окне *Редактирование энумератора* добавьте элементы перечисления.
+
Элемент перечисления состоит из псевдонима и значения перечисления -- будет содержаться в поле карточки.
+
.Пример заполнения энумератора
image::lay_Enumerator_edit.png[Пример заполнения энумератора]
+
Длина псевдонима должна быть не больше 64 символов.
+
Для элементов можно настроить отображаемые в карточке значения -- иначе отображается псевдоним. Для этого нажмите кнопку image:buttons/pencil-green.png[Карандаш] и добавьте локализованные значения для требуемых языков.
+
.Пример заполнения отображаемых значений элемента энумератора
image::lay_enumeratorLocalizedValues.png[Пример заполнения отображаемых значений элемента энумератора]
+
. В поле *При копировании* выберите способ переноса значения поля карточки, который будет применяться при копировании карточки и создании карточки по шаблону.
+
Поле доступно только для БД {dv}, работающей с *расширенными* метаданными.
+
.Доступные варианты:
* *Копировать значение поля* (поведение по умолчанию) -- при копировании/создании по шаблону карточки значение поля будет копироваться;
* *Очищать значение поля* -- при копировании/создании по шаблону карточки значение поля будет очищаться (устанавливаться в NULL);
* *Копировать объект по ссылке* -- при копировании/создании по шаблону карточки будет копироваться связанная карточка/файл. Данный вариант доступен только для полей типа RefCardID и FileID.
+
. Завершив настройки, нажмите на кнопку *ОК*.
+
В дальнейшем, любое созданное поле или секцию можно отредактировать с помощью кнопок *Редактировать поле* и *Редактировать секцию* на ленте окна редактирования метаданных, либо удалить, нажав кнопку *Удалить поле* или *Удалить секцию*. Эти команды также доступны в контекстном меню поля/секции.
