[[ariaid-title1]]
== Настройка бизнес-процесса

Бизнес-процесс можно настроить для карточки любого вида (карточки документа или задания). Ниже приведен пример настройки бизнес-процесса для карточки вида [.dfn .term]_Документ_. Подробная инструкция по настройке бизнес-процессов приведена в руководстве пользователя модуля «Docsvision 5. Управление процессами».

[NOTE]
====
[.note__title]#Важное замечание:# Для Web-клиента запуск бизнес-процесса по операции поддерживается только при переходе из одного состояния в другое. БП также не будет запущен при переходе из одного состояния в то же самое при выборе [.ph .uicontrol]*Повторить уведомление по заданию*.
====

В xref:cSub_Common.adoc[Общих настройках] вида можно задать связь карточки документа с одним или несколькими бизнес-процессами. Данная функция позволяет всем карточкам данного вида по умолчанию взаимодействовать с указанными бизнес-процессами, которые запускаются (автоматически или вручную) по событиям обработки карточки и могут обмениваться с ней значениями переменных.

В настройках вида задается не экземпляр бизнес-процесса, а его шаблон. После того, как настройка вида будет завершена, и на его основе будет создана карточка, из нее можно будет создавать экземпляры бизнес-процесса на основе указанного шаблона.

Для работы с бизнес-процессами, созданными из карточки, необходимо, чтобы у пользователя, под которым запущен сервис бизнес-процессов, в [.dfn .term]_Конструкторе ролей_ были настроены права на работу с операцией процесса и на чтение данной карточки.

Чтобы добавить в карточку шаблон бизнес-процесса, выполните следующие действия:

. [.ph .cmd]#Создайте новую карточку «Бизнес-процесс».#
. [.ph .cmd]#Откройте окно свойств бизнес-процесса.#
. [.ph .cmd]#На вкладке [.ph .uicontrol]*Переменные* в поле [.keyword]*Название* введите имя новой переменной.#
+
image::images/cSub_ProcessVariable.png[[.fig--title-label]#Рис. 1. # Задание переменной с типом Документ]
. [.ph .cmd]#В поле *Тип* выберите переменную `Карточка DV` с типом _Документ_.  #
+
image::images/cSub_VariableTypes.png[[.fig--title-label]#Рис. 2. # Выбор переменной 'Карточка DV' с типом 'Документ']
. [.ph .cmd]#На вкладке [.ph .uicontrol]*Дополнительно* в поле [.keyword]*Сохранять инициирующий документ в переменную* необходимо указать название созданной переменной. #
+
Соблюдение этих условий необходимо для того, чтобы шаблон бизнес-процесса отображался в диалоге выбора. Окно выбора показывает отфильтрованный список бизнес-процессов, куда входят только те карточки, которые отвечают указанным выше условиям.
+
image::images/cSub_ProcessPropertiesVariable.png[[.fig--title-label]##Рис. 3. ##Настройка дополнительных свойств бизнес-процесса]
. [.ph .cmd]#Перейдите на вкладку [.keyword]*Общие* и найдите область [.keyword]*Процессы*.#
+
image::images/cSub_Common_Processes_1.png[[.fig--title-label]##Рис. 4. ##Область для настройки связанных бизнес-процессов]
. [.ph .cmd]#В области [.keyword]*Процессы* нажмите кнопку image:images/Buttons/cSub_Add.png[image]. #
+
Появится окно для выбора шаблона бизнес-процесса.

image::images/cSub_SelectBPTemplate.png[[.fig--title-label]##Рис. 5. ##Окно выбора шаблона бизнес-процесса]
. [.ph .cmd]#Выберите нужный шаблон из списка и нажмите кнопку image:images/Buttons/cSub_Check.png[image] (также можно выбрать, нажав _Enter_ или дважды щелкнув по шаблону). #
+
Появится окно настроек связи данного шаблона бизнес-процесса с карточками текущего вида.

image::images/cSub_BP_settings.png[[.fig--title-label]#Рис. 6. # Пример окна настроек бизнес-процесса для вида 'Документ']

Данное окно содержит несколько групп параметров, которые описаны в таблице ниже.

[width="100%",cols="25%,25%,50%",options="header",]
|===
|Группа параметров |Состав |Назначение
|Общие a|
Поле *Название*

Поле *Процесс*

Диалог выбора иконки

Флаг *Разрешить просмотр бизнес-процесса из карточки*

Поле *Макс. количество*

a|
Данная группа параметров позволяет присвоить шаблону бизнес-процесса индивидуальное имя и иконку, разрешить/запретить открытие карточки процесса напрямую из карточки документа.

Поле *Название* по умолчанию заполняется названием выбранного шаблона бизнес-процесса. Поле Процесс используется для отображения шаблона бизнес-процесса. Иконка, выбранная в диалоге бизнес-процесса, будет отображаться на ленте инструментов процесса:

* при запуске бизнес-процесса, при установленном флаге *Разрешить просмотр бизнес-процесса из карточки*;
* для запущенного бизнес-процесса, при выборе политики запуска *Вручную из карточки*

Параметр *Макс. количество* обозначает количество экземпляров бизнес-процесса, которые разрешено создавать на основе шаблона.

|Политика запуска a|
Флаг *Вручную из карточки*

Флаг *При переходе состояний*

Флаг *По операции*   

a|
При запуске вручную бизнес-процесс будет запущен только после того, как пользователь явным образом сделает это, нажав соответствующую кнопку на ленте карточки документа.

Автоматический запуск возможен в двух вариантах:

* При совершении операции перехода в другое состояние (нажатие кнопки на ленте в карточке документа). В этом случае пользователю будет предложено выбрать одно из состояний, заранее настроенных в *Конструкторе состояний*;
* Запуск _по операции_ позволяет привязать старт бизнес-процесса к одному или нескольким действиям с карточкой документа. В качестве действий может быть указаны манипуляции с вложенными файлами, версиями файлов, подписание документа и другие. Бизнес-процесс будет запущен по каждой указанной операции и при каждом указанном переходе в другое состояние.

Одновременно можно использовать как один, так и все имеющиеся способы запуска бизнес-процесса.

|Права на запуск бизнес-процесса |Список ролей пользователей a|
Возможность запускать бизнес-процесс доступна только тем пользователям, которые исполняют указанные в данном поле роли. _Список ролей_ должен быть заранее настроен в *Конструкторе ролей*.

При выборе роли в данном диалоге, для операции, соответствующей данному процессу в *Конструкторе ролей* будут назначены указанные права (разрешение, запрет или не определено).

Если в *Конструкторе ролей* для роли указан запрет или разрешение на операцию, то запись появится в данном поле. При назначении прав сначала производится выбор роли, а затем для имеющихся состояний указывается доступность операции для данной роли.

|Переменные |Таблица настройки обмена данными a|
Данная таблица позволяет поставить в соответствие переменным бизнес-процесса атрибуты карточки. Выбор переменных можно осуществлять только в соответствии с типом данных.

Направление обмена может иметь любое из трех значений:

* *В процесс при запуске*. Значение атрибута копируется в процесс один раз в момент запуска бизнес-процесса.
* *В процесс при каждом изменении*. Копирование будет происходить при каждом изменении и сохранении атрибута.
* *Из процесса*. Значение будет скопировано из процесса в соответствующий атрибут карточки документа.

Флаг *Обязательное* применим только при направлении обмена данными из карточки в процесс. В противном случае значение игнорируется.

Процесс не будет запущен, пока не будут заполнены данные поля.

|===
. [.ph .cmd]#Настройте бизнес-процесс.#
. [.ph .cmd]#После окончания настройки нажмите на кнопку [.keyword]*ОК*.#

*На уровень выше:* xref:../pages/cSub_Common.adoc[Общие настройки]
