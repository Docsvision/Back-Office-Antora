= Дерево исполнения

== Назначение

Элемент предназначен для наглядного отображения жизненного цикла карточек _Задание_ и _Группа заданий_. Пользуясь данным элементом, пользователь получает возможность как отслеживать выполнение задания, так и выполнять операции с заданием (создавать подчиненные задания).

Элемент применяется в карточках следующих базовых типов: _Задание_, _Группа заданий_, _Документ_.

Управление деревом заданий выполняется из контекстного меню. Меню содержит следующие пункты:

* Для всех узлов, если есть родительские задания и режим отображения "подчиненные":
** Показать дерево полностью;
* Для узла любого типа:
** Обновить;
** Свернуть/развернуть узел;
** Свернуть все/развернуть все.
* Для корневого задания и подчиненного:
** Новое задание -- создает новое дочернее задание;
** Создать группу заданий - создает новую дочернюю группу заданий.
* Только для подчиненных заданий:
** Открыть -- открывает выбранную карточку подчиненного задания;
** Создать Группу заданий -- создает подчиненную карточку Группа заданий;
** Создать Задание -- создает подчиненную карточку Задание;
** Удалить -- удаляет выбранную карточку подчиненного задания;
** Копировать -- создает копию подчиненного задания;
** Перенести результаты в родительское задание (только в состоянии `Завершено` для заданий второго и выше уровня вложенности) -- копирование отчетов из дочерних заданий в родительские.
* Для групп заданий:
** Открыть -- открывает выбранную карточку подчиненной группы заданий;
** Создать Задание -- создает подчиненное задание с копированием части полей согласно настройке в __Справочнике видов карточек (__раздел "Копировать из родительского задания");
** Удалить -- удаляет подчиненное задание и группу заданий;
** Свернуть -- сворачивает вложенные элементы Группы заданий;
** Развернуть -- разворачивает вложенные элементы Группы заданий.

== Отображение в области "Панель инструментов"

.Отображение в области "Панель инструментов"
image::lay_Element_Tree_Of_Performing.png[Отображение в области "Панель инструментов"]

== Отображение в запущенной карточке

В карточке данный элемент управления представлен в виде панели, на которой фиксируются события, связанные с созданием карточки и изменениями её состояний.

В верхней части элемента отображается дерево заданий, в нижней части - представление для выделенного элемента дерева.

.Отображение в запущенной карточке
image::lay_Card_Tree_Of_Performing.png[Отображение в запущенной карточке]

Каждая запись может содержать иконку, соответствующую настройке задания:

[cols="12%,88%",]
|===
|*Кнопка* |*Название*
|image:buttons/lay_ico_time.png[image] |Задание просрочено
|image:buttons/lay_ico_voskl.png[image] |Задание с высокой важностью
|image:buttons/lay_ico_arr_blue_down.png[image] |Задание с низкой важностью
|image:buttons/lay_ico_control.png[image] |Задание на контроле
|===

== Общие

xref:lay_Elements_general.adoc[Общие свойства элементов управления]

== Поведение

Исключить делегатов::
При выборе значения *Нет* отображение записей о делегировании разрешено, при выборе значения *Да* - запрещено.
Операции::
В поле задаются операции, которые могут быть выполнены с элементом дерева:
+
* _Копирование задания_ - копирование карточки _Задание_;
* _Создание группы заданий_ - создание новой связанной карточки _Группа заданий_ для выделенного элемента в дереве;
* _Создание задания_ - создание новой связанной карточки _Задание_ для выделенного элемента в дереве;
* _Удаление группы заданий_ - удаление связанной карточки _Группа заданий_ для выделенного элемента в дереве;
* _Удаление задания_ - удаление связанной карточки _Задание_ для выделенного элемента в дереве.
Столбцы::
В поле задаются названия для отображаемых столбцов. Выбор производится из следующих доступных вариантов:
+
* _Название_ - название карточки _Задание_ или _Группа заданий_;
* _Автор_ - автор карточки _Задание_ или _Группа заданий_;
* _Состояние_ - текущее состояние карточки _Задание_ или _Группа заданий_;
* _Дата начала плановая_ - дата, которая была определена автором задания для начала исполнения карточки _Задание_ или _Группа заданий_;
* _Дата завершения плановая_ - дата, которая была определена автором задания для завершения исполнения карточки _Задание_ или _Группа заданий_;
* _Дата начала фактическая_ - дата, которая была определена исполнителем для начала исполнения задания;
* _Дата завершения фактическая_ - дата, которая была определена исполнителем для завершения задания;
* _Назначенный исполнитель_ - имя назначенного автором исполнителя для задания;
* _Текущий исполнитель_ - имя исполнителя, который на текущий момент работает с заданием;
* _Исполнитель_ - имя исполнителя карточки _Задание_ или _Группа заданий_ на момент делегирования задания. Поле заполняется только в записях делегированных заданий;
* _Делегировал_ - имя сотрудника, который делегировал задание другому исполнителю;
* _Причина делегирования_ - причина делегирования задания:
** Если делегирование происходит вручную, то будет отображаться значение *Делегирование*;
** Если задание исполняет не текущий исполнитель, а его заместитель или другой сотрудник, которому разрешено выполнять исполнение задания, то будет отображаться значение *Автоматически*.
* _Признак возврата_ - признак необходимости возврата задания с делегирования сотруднику, который делегировал задание;
* _Возвращено_ - признак, указывающий, что задание возвращено с делегирования;
* _Дата делегирования_ - дата выполнения операции делегирования задания исполнителем;
* _Иконка состояния_ - отображение иконки, соответствующей текущему состоянию карточки _Задание_ и _Группа заданий_;
* _Тип маршрутизации_ - тип маршрутизации карточки _Группа заданий_;
* _Ответственный исполнитель_ - имя сотрудника, для которого в карточке _Группа заданий_ задано значение в поле _Ответственный исполнитель_;
* _Делегат_ - имена делегатов задания:
** в узлах _дерева исполнения_, соответствующих основному или подчиненному заданию, в столбце будут отображаться актуальные делегаты задания. Если делегатов несколько, в ячейке таблицы будет отображаться список сотрудников;
** в узлах _дерева исполнения_, соответствующих делегированию, будет отображаться фамилия делегата и информация о том, кому было делегировано задание.
+
  Если один из делегировавших сотрудников отменит делегирование, строка, соответствующая факту делегирования, будет удалена из _дерева исполнения_.
Показывать всю иерархию заданий::
В поле определяется вид дерева по умолчанию:
+
* *Нет* - в дереве отображается ветка текущего задания, игнорируются родительские задания и другие ветки;
* *Да* - в дереве отображаются все ветки, начиная с корневой.
Режим переноса результатов::
Определяет способ переноса ссылок из подчиненного задания в родительское при выполнении команды "Перенести результаты в родительское задание":
+
* *Создать копию* -- в родительское задание будут добавлены ссылки на копии карточек (будут созданы при переносе), на которые ссылается подчиненное задание;
* *Использовать ссылку* -- в родительское задание будут добавлены ссылки на оригинальные карточки, на которые ссылается подчиненное задание;
* *Отобразить диалог для выбора режима* -- пользователю будет предложено самостоятельно выбрать режим переноса результатов (создавать копию или добавлять ссылку).

== Данные

Виды карточек::
Параметр определяет допустимые для отображения в элементе виды карточек _Задание_. Для выбранного вида имеется возможность автоматического добавления дочерних видов. Для настройки данной возможности следует выбрать вид в окне *Разрешенные типы и виды*, затем вызвать контекстное меню для этого вида и включить опцию _Включая дочерние_. При включении опции, новые создаваемые подчиненные виды автоматически добавляются в элемент управления и становятся доступными для выбора.
Источник данных::
Тип поля данных - _RefcardID_ (поле - ссылка на системную карточку списка заданий). Например, для карточки задания следует выбрать значение _Задание_.
Операции состояния::
Для функции дерева (команд) выбираются операции из _Конструктора состояний_. Функции дерева будут доступны в зависимости от настроек автомата состояний и ролевой модели. В поле следует выбрать требуемую операцию:
+
* _Копирование задания_ - копирование карточки _Задание_;
* _Создание группы заданий_ - создание новой связанной карточки _Группа заданий_ из открытой карточки _Задание_;
* _Создание задания_ - создание новой связанной карточки _Задание_ из открытой карточки _Задание_;
* _Удаление группы заданий_ - удаление связанной карточки _Группа заданий_ из открытой карточки _Задание_;
* _Удаление задания_ - удаление связанной карточки _Задание_ из открытой карточки _Задание_.
Элемент данных::
Например, для карточки задания следует выбрать _Список подчиненных заданий_.
Ограничение типа ссылок::
Список типов ссылок, которые не должны отображаться в окне настройки переноса результатов из подчиненного задания в родительское (команда "Перенести результаты в родительское задание"). Если типы ссылок не выбраны, пользователь сможет переносить в родительское задание ссылки любых типов.

== Представления узла

Представление делегата::
В поле задается желаемый вид представления для делегата. В качестве представлений перечисленных ниже свойств необходимо использовать представления с колонкой _DelegateId_ (чтобы колонка не отображалась, установите опцию *Скрытая колонка* в настройках представления). Необходимо настроить колонку на поле _RowId_ секции _Задание / Список делегирования_. Только в этом случае представление будет отображаться для указанных строк в _Дереве исполнения_.
Представление основного задания::
В поле задается желаемый вид представления для основной карточки *Задание*.
Представление дочернего задания::
В поле задается желаемый вид представления для дочерней карточки *Задание*.

== Настройка локализации

Допускается xref:lay_Locale_common_element_properties.adoc[локализация _общих_ свойств] элемента. Описание настройки локализации содержится в разделе xref:lay_Elements_general.adoc[Общие свойства элементов управления].
