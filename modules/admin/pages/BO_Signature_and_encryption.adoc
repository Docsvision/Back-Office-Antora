= Раздел "Подписи и шифрование"

Электронно-цифровые подписи применяются для аутентификации информации, а именно для установления факта модификации информации и получения гарантии ее подлинности, а также подтверждения авторства внесенных в документы изменений.

.В системе {dv} могут применяться все возможные виды подписей, определяемые по Федеральному закону N 63-ФЗ "Об электронной подписи":
* _Простая подпись_ -- это электронная подпись, которая посредством использования кодов, паролей или иных средств, подтверждает факт формирования электронной подписи определенным лицом. Данная подпись применяется для подтверждения того, что пользователь под учетной записью Windows выполнил какую-либо операцию. В дополнение к описанным выше требованиям, в системе {dv} при наложении простых подписей используется механизм хэш-функций, применяемых к объектам, включаемым в подпись. Механизм служит для проверки неизменности объекта на момент подписи. Примером может служить подпись, добавляемая в электронное письмо;
* _Усиленная подпись_ -- электронная подпись, при наложении которой выполняется проверка наличия у пользователя сертификата. В данному виду относятся:
** _Усиленная неквалифицированная электронная подпись_ -- подпись, созданная с помощью криптографических средств и имеющая сертификат от не аккредитованного удостоверяющего центра;
** _Усиленная квалифицированная электронная подпись_ -- подпись, созданная с помощью подтвержденных ФСБ криптографических средств и имеющая сертификат от аккредитованного удостоверяющего центра, выступающего гарантом подлинности подписи.
** _Усовершенствованная квалифицированная электронная подпись_ -- подпись, в которую включена информация о времени создания подписи (TSP) и о статусе сертификата электронной подписи (OCSP) в момент подписания (действителен или отозван).

Использование простой подписи доступно пользователям без дополнительной настройки. Для использования усиленной подписи (квалифицированной или неквалифицированной) администратор {dv} должен настроить параметры подписания (рассмотрено ниже по тексту).

Состав подписи (набор атрибутов, включаемых в подпись) определяется настройками вида карточек в "Справочнике видов карточек" и не зависит от вида используемой подписи.

.Чтобы настроить параметры шифрования и подписи файлов:
. В области *Категории* выберите ветку *{bo}* > *Подписи и шифрование*.
+
При этом в средней части карточки справочника будет отображена область *Подписи и шифрование*.
+
.Настройки подписи и шифрования базовых объектов
image::BO_Signature_and_Encryption.png[Настройки подписи и шифрования базовых объектов]
+
. В поле *Провайдер* выберите названия провайдера для шифрования и подписи файлов.
+
Система {dv} интегрируется с любыми системами КЗИ (крипто-провайдерами), поддерживающими интерфейс Microsoft Crypto API. Выяснить, поддерживает ли конкретная система КЗИ интерфейс Crypto API, можно у ее производителя.
+
.Примерами систем, поддерживающих Crypto API, являются:
+
* КриптоПро CSP (описание продукта можно найти на сайте производителя по адресу http://www.cryptopro.ru/cryptopro/products/csp/default.htm);
* Signal-COM CSP (описание продукта можно найти на сайте производителя по адресу http://www.signal-com.ru/ru/prod/crypt/signal_com/).
+
[IMPORTANT]
====
Компоненты системы КЗИ должны быть установлены на всех клиентских рабочих местах, иначе возможность работы с предоставляемыми СКЗИ функциями (подписания, проверка подписи и др.) будет невозможна. К примеру, проверка подписи, установленной с использованием криптопровайдера КриптоПро, будет невозможна на рабочих местах, на которых не установлен КриптоПро CSP.
====
+
Поддержка Crypto API -- необходимое, но не достаточное условие для возможности интеграции криптопровайдера с {dv}, так как в реализации каждого провайдера могут быть свои нюансы (особенности реализации методов), препятствующие их совместной корректной работе. Таким образом, каждый конкретный провайдер должен предварительно проверяться на совместимость с {dv}. Эту проверку можно выполнить самостоятельно или обратиться к любому партнеру {dv}. {dv} _гарантирует_ корректную работу со стандартными крипто-провайдерами Microsoft, входящими в состав операционной системы Windows, а также поддержку аутентификации и ЭП смарт-карт eToken (фирмы-производителя Алладин Р.Д.)
+
.Чтобы выбрать провайдера:
.. Нажмите на кнопку image:buttons/threedots.png[image].
+
Будет открыто окно *Выбор провайдера шифрования*.
+
В этом окне отображается дерево, узловыми элементами которого являются *типы*, а ветками -- *названия* провайдеров.
+
.Выбор провайдера шифрования
image::SelectEncryptionProvider.png[Выбор провайдера шифрования]
+
.. Выберите провайдера, затем нажмите на кнопку *ОК*.
+
. В поле *Алгоритм шифрования* выберите из раскрывающегося списка необходимый алгоритм для проведения операции шифрования файлов.
+
Предлагаемый список алгоритмов зависит от выбранного ранее провайдера.
+
. В поле *Длина ключа* выбирается необходимая длина ключа для шифрования.
+
Длина ключа должна выбираться в зависимости от используемой в организации операционной системы.
+
.Возможен выбор одного из следующих вариантов:
* *По умолчанию* -- длина ключа определяется по умолчанию.
* *Минимальная* -- длина ключа составляет 40 символов.
* *Максимальная* -- длина ключа составляет 56 символов.
* *Пользовательская* -- длина ключа задается в зависимости от выбранного алгоритма шифрования, число символов должно быть кратным 8.
+
. В поле *Алгоритм подписи* выберите из раскрывающегося списка необходимый алгоритм подписания файлов.
+
Список доступных алгоритмов подписи зависит от выбранного провайдера.
+
. Для использования усиленной подписи со штампом времени, настройте параметры подключения к серверу службы выдачи штампов времени:
+
.. В поле `TSP провайдер` выберите DLL файл, содержащий реализацию функции провайдера службы штампов времени.
+
Стандартная реализация провайдера службы штампов времени для криптопровайдера КриптоПро содержится в файле `[Каталог установки модуля]/{dv}.BackOffice.ObjectModel.CryptoPro.dll`.
+
Если требуется взаимодействовать со службой штампов времени другого криптопровайдера, необходимо самостоятельно разработать компонент, содержащий реализацию провайдера к этой службе. Обратитесь к описанию интерфейса {dv}.BackOffice.ObjectModel.Services.ITspService, приведенному в документе _{dv} 5.5. Руководство программиста_, для получения дополнительной информации.
.. В поле *Адрес TSP сервиса* укажите путь к сервису службы штампов времени.
.. В поле `OCSP провайдер` выберите DLL файл, содержащий реализацию функции провайдера службы актуальных статусов сертификатов.
+
Стандартная реализация провайдера службы актуальных статусов сертификатов для криптопровайдера КриптоПро содержится в файле `[Каталог установки модуля]/{dv}.BackOffice.ObjectModel.CryptoPro.dll`.
+
Если требуется взаимодействовать со службой актуальных статусов сертификатов другого криптопровайдера, необходимо самостоятельно разработать компонент, содержащий реализацию провайдера к этой службе. Обратитесь к описанию интерфейса {dv}.BackOffice.ObjectModel.Services.IOcspService, приведенному в документе _{dv} 5.5. Руководство программиста_, для получения дополнительной информации.
+
.. Указывать адрес OCSP сервиса (службы актуальных статусов сертификатов) не требуется.
+
*Для формирования подписей формата CADES-X Long Type 1 (усовершенствованная подпись) должна быть указан TSP и OCSP провайдеры, а также указан адрес TSP сервиса.*
+
. В поле *Файлы для шифрования* при помощи флагов определите тип файлов, для которого может выполняться шифрование:
+
* *Основные* -- будет выполняться шифрование только основных файлов, вложенных в карточку;
* *Дополнительные* -- будет выполняться шифрование дополнительных файлов, вложенных в карточку.
+
. При необходимости установите флаг *Проверять действительность сертификата, используя внешние списки отзыва сертификатов*.
+
Если этот флаг установлен, а в использованном сертификате указаны пути к спискам отзыва (CRL), публикуемым удостоверяющим центром, то в процессе проверки подписи будет также проверена действительность сертификата по этим спискам. Если проверка даст отрицательный результат, то подпись будет верна только математически (то есть будет удостоверено, что содержание документа соответствует подписи (не изменялось), но при этом сертификат подписи недействителен (отозван, или истек срок его действия)).
+
. Чтобы выявить, успешно ли работают заданные параметры подписи и шифрования, нажмите на кнопку *Проверить*.
