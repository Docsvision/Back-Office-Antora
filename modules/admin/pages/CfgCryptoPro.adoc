= Настройка работы с криптопровайдером КриптоПро

Для возможности подписания документов ЭП с использованием криптопровайдера КриптоПро, администратор должен настроить {dv}.

. Установите на компьютер с сервером {dv} и на клиентские компьютеры компоненты КриптоПро, см. требования в xref:ROOT:requirements.adoc#crypto-pro[этом] пункте.
. Откройте справочник _Системные настройки_ от имени администратора {dv}.
. Перейдите в раздел menu:{bo}[Подписи и шифрование].
+
.Настройки подписи и шифрования базовых объектов
image::BO_Signature_and_Encryption.png[Настройки подписи и шифрования базовых объектов]
+
. Настройте параметры подписания и шифрования.
+
.. В поле *Провайдер* выберите значение "Crypto-Pro GOST R 34.10-2012 Cryptographic Service Provider" или "Crypto-Pro GOST R 34.10-2012 Strong Cryptographic Service Provider" (в зависимости от алгоритма, с помощью которого были сгенерированы сертификаты).
.. В поле *Алгоритм шифрования* выберите "GOST 28147-89".
.. В поле *Алгоритм подписи* выберите "GOST R 34.11-2012 256" или "GOST R 34.11-2012 256" (в зависимости от выбранного _провайдера_).
.. В поле *TSP провайдер* выберите файл `[Каталог установки модуля "Windows-клиент"]/BaseObjects/{dv}.BackOffice.ObjectModel.CryptoPro.dll`.
.. В поле *Адрес TSP сервиса* введите адрес службы штампов времени, предоставляющей штампы времени для ЭП.
+
[NOTE]
====
Адрес тестового TSP-сервера компании КриптоПро: http://testca.cryptopro.ru/tsp/tsp.srf.

Для получения актуальных адресов тестового и рабочего TSP-сервера рекомендуется обращаться в компанию КриптоПро.
====
+
.. В поле *OCSP провайдер* выберите файл `[Каталог установки модуля "Windows-клиент"]/BaseObjects/{dv}.BackOffice.ObjectModel.CryptoPro.dll`.
.. При необходимости настройте остальные параметры.
+
Указывать адрес OCSP сервиса не требуется.
+
. Установите сертификаты КриптоПро:
+
.. Корневой сертификат удостоверяющего центра, выпустившего сертификат пользователяfootnote:[Например, корневой сертификат КриптоПро.] в хранилище "Доверенные корневые центры сертификации" на уровне "Локальный компьютер" -- на компьютер с сервером {dv} и на клиентские компьютеры.
.. Сертификат пользователя в хранилище "Личное" на уровне "Текущий пользователь" -- на клиентские компьютеры.
+
В данной инструкции перечислены действия по настройке {dv} с точки зрения "классического" варианта установки сертификатов КриптоПро -- сертификаты устанавливаются на компьютер пользователя. При использовании функции КриптоПро "Облачный провайдер" (КриптоПро CSP 5.0 и выше), система {dv} настраивается аналогичным образом, а установка сертификатов должна выполняться по инструкции компании КриптоПро для работы с "облачными токенами".
+
*Обратите внимание.* В случае, если лицензия на компоненты КриптоПро CSP истекла, блокируется возможность добавления новых подписей. Если подпись была добавлена ранее и срок действия сертификата ЭП не истёк, возможность проверки такой подписи не будет заблокирована. Проверка старых подписей выполняется успешно в любом случае.
