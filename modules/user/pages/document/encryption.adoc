= Шифрование файлов

Для базового типа карточки _Документ_ существует возможность шифрования файлов. Шифрование становится доступным только после того как администратор xref:admin:system-settings.adoc#signature-cypher[настроил] параметры шифрования в справочнике _Системные настройки_. В _Конструкторе ролей_ для шифрования используется операция _Шифрование файлов_.

Шифрование в карточках становится доступным только для тех пользователей, у которых в _Справочнике сотрудников_ указан сертификат.

Зашифрованные файлы запрещено отправлять на согласование, однако с ними допускается создание заданий и групп заданий. На вкладке _Ссылки_ для режима _Файлы_ запрещен просмотр зашифрованных файлов для сотрудников, у которых не настроен доступ к зашифрованным файлам.

.Чтобы зашифровать файлы карточки:
. Откройте карточку вида _Документ_.
. На ленте карточки нажмите на кнопку image:buttons/lock.png[Замок с ключом] *Шифрование файлов*.
+
Если шифрование выполняется для _Дополнительных_ файлов, в списке рядом с их названием появится пометка о том, что файл является дополнительным.
+
.Шифрование файлов карточки
image::document-encryption.png[Шифрование файлов карточки]
+
. В области _Список файлов_ выберите файл, для которого требуется настроить шифрование.
+
Шифрование выполняется сразу для всех файлов, однако список сотрудников, которые будут иметь доступ к зашифрованному файлу, необходимо сформировать отдельно для каждого из файлов.
+
. Укажите сотрудников, которые могут иметь доступ к зашифрованному файлу:
+
.. Нажмите на кнопку image:desdirs:buttons/plus-green.png[Зелёный плюс] и выберите запись из _Справочника сотрудников_.
.. Введите первые буквы имени сотрудника в строку быстрого поиска, затем дважды щелкните левой клавишей мыши на найденной записи.
+
Выбрать можно только тех сотрудников, у которых в _Справочнике сотрудников_ указан сертификат подписи. Если сертификат отсутствует, при подтверждении выбора будет выдано предупреждение: `Не удалось добавить сотрудника. У пользователя отсутствует сертификат. Обратитесь к администратору системы`.
+
. Нажмите на кнопку *Зашифровать*.
+
В зависимости от настроек в справочнике сотрудников, может появиться окно выбора сертификата подписи.
+
. Укажите тип подписи, затем нажмите на кнопку *ОК*.
+
Если сертификат действителен, основные и/или дополнительные файлы будут зашифрованы в соответствии с настройками провайдера, алгоритма и ключа из справочника _Системные настройки_. Сертификаты пользователей, указанных в списке, берутся из настроек _Справочника сотрудников_. Для каждого из указанных пользователей формируется ключ.
+
В карточке название зашифрованного файла станет серым, а в иконке файла появится значок, указывающий, что файл зашифрован.
+
Зашифрованный файл будет отображаться в карточке документа для всех пользователей, имеющих доступ к данной карточке. Прочитать такой файл смогут только пользователи, у которых настроен доступ к зашифрованному файлу. Если доступа нет, будет выдано сообщение: `Файл зашифрован. Не удалось выполнить операцию в связи с ограничением прав доступа`. При открытии на чтение зашифрованный файл будет автоматическая дешифрован и выгружен во временную папку.
+
У пользователя, который выполнил шифрование файлов, на ленте карточки станет доступным выпадающее меню кнопки *Шифрование файлов*, содержащее команды для управления зашифрованными файлами.
+
.Меню управления зашифрованными файлами
image::document-encoding-menu.png[Меню управления зашифрованными файлами]
+
. После добавления нового основного и/или дополнительного файла, зашифруйте его командой _Зашифровать файлы_ в меню кнопки шифрования.
+
Команда меню будет недоступна после добавления дополнительных файлов, если для них не настроено шифрование в справочнике _Системные настройки_.
+
. Чтобы расшифровать файлы, выберите в меню кнопки команду *Расшифровать файлы*.
+
Расшифрованные файлы становятся доступными для редактирования.
+
. Чтобы отредактировать список сотрудников, для которых было выполнено шифрование, выберите в меню кнопки команду _Редактировать список сотрудников_. В открывшемся окне _Шифрование файлов_ отредактируйте список, затем нажмите на кнопку *Зашифровать*.
+
Аналогичные действия будут выполнены при нажатии на саму кнопку *Шифрование файлов*.
+
Если состав сотрудников изменится, файлы будут повторно зашифрованы с учетом изменений. При этом, в зависимости от настроек _Справочника сотрудников_, может быть запрошен сертификат подписи.
